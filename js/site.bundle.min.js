// حفظ النموذج محليًا ومعاينة الصورة
document.addEventListener("DOMContentLoaded", function(){
  var form=document.querySelector("form");
  if(form){
    var key="reportMoe5Form";
    var saved=localStorage.getItem(key);
    if(saved){
      try{ var obj=JSON.parse(saved); Object.keys(obj).forEach(function(k){ if(form.elements[k]) form.elements[k].value=obj[k]; }); }catch(e){}
    }
    form.addEventListener("submit", function(e){
      e.preventDefault();
      var fd=new FormData(form), o={};
      fd.forEach(function(v,k){ o[k]=v; });
      localStorage.setItem(key, JSON.stringify(o));
      alert("تم حفظ البيانات محلياً (localStorage).");
    });
  }
  // معاينة الصورة
  document.querySelectorAll(".preview-thumb").forEach(function(img){
    img.style.cursor="pointer";
    img.addEventListener("click", function(){
      var src=this.src; var m=document.createElement("div");
      m.style.cssText="position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:9999";
      m.innerHTML='<img src="'+src+'" style="max-width:95%;max-height:95%;border-radius:6px">';
      m.addEventListener("click", function(){ m.remove(); });
      document.body.appendChild(m);
    });
  });
});
